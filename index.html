<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>For My World | Jan 12th</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600&family=Montserrat:wght@200;300;400&family=Pinyon+Script&display=swap" rel="stylesheet">

    <style>
        /* Base Reset */
        body { 
            margin: 0; 
            overflow: hidden; /* Hide scrollbars, we handle scroll manually */
            background-color: #000; 
            color: white; 
            font-family: 'Montserrat', sans-serif; 
        }

        /* Typography Presets */
        .font-cinematic { font-family: 'Cinzel', serif; letter-spacing: 0.1em; text-transform: uppercase; }
        .font-romantic { font-family: 'Pinyon Script', cursive; color: #ffbfd3; text-shadow: 0 0 15px rgba(255, 107, 157, 0.8); }
        .text-glow { text-shadow: 0 0 20px rgba(255,255,255,0.4); }

        /* --- HEART INTRO LAYER --- */
        #intro-layer {
            position: fixed; top: 0; left: 0; width: 100%; height: 100vh;
            background: #000; z-index: 100;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            cursor: pointer;
        }
        
        /* The Heart Shape */
        .heart-wrapper { position: relative; width: 100px; height: 100px; animation: heartbeat 1.5s infinite ease-in-out; }
        .heart-shape {
            width: 100%; height: 100%; background-color: #e91e63;
            transform: rotate(-45deg); position: absolute;
            box-shadow: 0 0 50px rgba(233, 30, 99, 0.6);
        }
        .heart-shape::before, .heart-shape::after {
            content: ""; width: 100%; height: 100%; background-color: #e91e63;
            border-radius: 50%; position: absolute;
        }
        .heart-shape::before { top: -50%; left: 0; }
        .heart-shape::after { top: 0; left: 50%; }

        .intro-text { margin-top: 80px; font-family: 'Cinzel'; font-size: 0.8rem; letter-spacing: 0.3em; color: rgba(255,255,255,0.7); }

        @keyframes heartbeat {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        /* --- 3D CANVAS & TEXT OVERLAYS --- */
        #canvas-container { position: fixed; top: 0; left: 0; width: 100%; height: 100vh; z-index: 1; opacity: 0; }

        /* Floating Text Container */
        #text-layer {
            position: fixed; top: 0; left: 0; width: 100%; height: 100vh;
            z-index: 10; pointer-events: none; /* Allows scrolling through text */
        }

        /* Individual Text Sections */
        .story-section {
            position: absolute; width: 100%; height: 100%;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            opacity: 0; 
            transform: scale(0.8) translateY(50px);
            transition: opacity 1s ease, transform 1s ease;
            text-align: center;
            padding: 20px;
        }

        .story-section.active {
            opacity: 1;
            transform: scale(1) translateY(0);
        }

        /* Progress Bar */
        #progress-line {
            position: fixed; bottom: 0; left: 0; height: 3px; background: linear-gradient(90deg, #ff3860, #ffffff);
            width: 0%; z-index: 50; transition: width 0.1s linear;
        }
    </style>
</head>
<body>

    <audio id="bg-music" loop><source src="song.mp3" type="audio/mpeg"></audio>

    <div id="progress-line"></div>

    <div id="intro-layer">
        <div class="heart-wrapper">
            <div class="heart-shape"></div>
        </div>
        <div class="intro-text">Click to Open My Heart</div>
    </div>

    <div id="canvas-container"></div>

    <div id="text-layer">
        
        <div class="story-section" id="sec-0">
            <h1 class="font-cinematic text-5xl md:text-7xl mb-4 text-glow">I Am Sorry</h1>
            <p class="text-xl md:text-2xl font-light text-gray-300 max-w-2xl">
                I let the noise of the world drown out the most important voice in my life.<br>
                <span class="font-romantic text-4xl text-pink-400">Yours.</span>
            </p>
            <div class="mt-12 text-sm uppercase tracking-[0.5em] text-gray-500 animate-bounce">Scroll Down</div>
        </div>

        <div class="story-section" id="sec-1">
            <h2 class="font-cinematic text-4xl mb-6">The Realization</h2>
            <p class="text-lg text-gray-200 max-w-xl leading-relaxed">
                Looking back, I see where I went wrong. I see the moments I missed and the words I should have said.
                I promise to never let my ego stand between us again.
            </p>
        </div>

        <div class="story-section" id="sec-2">
            <h1 class="font-romantic text-6xl md:text-8xl mb-4">Us.</h1>
            <p class="text-xl font-light">
                Look at these moments. <br>
                This is what matters. Not the fight, but the <i>light</i> we create together.
            </p>
        </div>

        <div class="story-section" id="sec-3">
            <p class="font-cinematic text-yellow-500 text-sm tracking-widest mb-2">Upcoming</p>
            <h1 class="font-cinematic text-6xl md:text-8xl text-white mb-2">Jan 12th</h1>
            <p class="font-romantic text-4xl md:text-5xl text-gray-300">Our Anniversary</p>
            <br>
            <p class="max-w-md text-gray-400">Let's restart. Let's make this day about love, forgiveness, and the future.</p>
        </div>

        <div class="story-section" id="sec-4">
            <h2 class="font-cinematic text-4xl mb-8">My Vows to You</h2>
            <div class="space-y-6 text-xl font-light">
                <p>To listen with an open heart.</p>
                <p>To cherish you on the good days and the bad.</p>
                <p>To be the man you deserve.</p>
            </div>
        </div>

        <div class="story-section" id="sec-5">
            <h1 class="font-cinematic text-5xl md:text-7xl mb-6">I Love You</h1>
            <p class="font-romantic text-3xl md:text-5xl text-pink-300">
                Please forgive me?
            </p>
        </div>

    </div>

    <script>
        // --- A. IMAGE CONFIGURATION ---
        // These are your exact 28 files.
        const imageFiles = [
            "WhatsApp Image 2025-12-27 at 3.28.59 PM.jpeg",
            "WhatsApp Image 2025-12-27 at 3.29.13 PM.jpeg",
            "WhatsApp Image 2025-12-27 at 3.29.14 PM.jpeg",
            "WhatsApp Image 2025-12-27 at 3.29.15 PM (1).jpeg",
            "WhatsApp Image 2025-12-27 at 3.29.15 PM (2).jpeg",
            "WhatsApp Image 2025-12-27 at 3.29.15 PM.jpeg",
            "WhatsApp Image 2025-12-27 at 3.29.16 PM (1).jpeg",
            "WhatsApp Image 2025-12-27 at 3.29.16 PM.jpeg",
            "WhatsApp Image 2025-12-27 at 3.29.17 PM (1).jpeg",
            "WhatsApp Image 2025-12-27 at 3.29.17 PM (2).jpeg",
            "WhatsApp Image 2025-12-27 at 3.29.17 PM.jpeg",
            "WhatsApp Image 2025-12-27 at 3.29.18 PM (1).jpeg",
            "WhatsApp Image 2025-12-27 at 3.29.18 PM.jpeg",
            "WhatsApp Image 2025-12-27 at 3.29.19 PM (1).jpeg",
            "WhatsApp Image 2025-12-27 at 3.29.19 PM (2).jpeg",
            "WhatsApp Image 2025-12-27 at 3.29.19 PM.jpeg",
            "WhatsApp Image 2025-12-27 at 3.29.20 PM (1).jpeg",
            "WhatsApp Image 2025-12-27 at 3.29.20 PM.jpeg",
            "WhatsApp Image 2025-12-27 at 3.29.21 PM (1).jpeg",
            "WhatsApp Image 2025-12-27 at 3.29.21 PM (2).jpeg",
            "WhatsApp Image 2025-12-27 at 3.29.21 PM.jpeg",
            "WhatsApp Image 2025-12-27 at 3.29.22 PM (1).jpeg",
            "WhatsApp Image 2025-12-27 at 3.29.22 PM.jpeg",
            "WhatsApp Image 2025-12-27 at 3.29.23 PM (1).jpeg",
            "WhatsApp Image 2025-12-27 at 3.29.23 PM.jpeg",
            "WhatsApp Image 2025-12-27 at 3.29.24 PM.jpeg",
            "WhatsApp Image 2025-12-31 at 2.29.37 PM.jpeg",
            "WhatsApp Image 2026-01-02 at 12.26.15 AM.jpeg"
        ];

        // --- B. THREE.JS INITIALIZATION ---
        const container = document.getElementById('canvas-container');
        const scene = new THREE.Scene();
        // Cinematic Black Void Fog
        scene.fog = new THREE.FogExp2(0x000000, 0.02);

        const camera = new THREE.PerspectiveCamera(70, window.innerWidth / window.innerHeight, 0.1, 1000);
        camera.position.set(0, 0, 5); // Start position

        const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
        container.appendChild(renderer.domElement);

        // --- C. GENERATING THE "SNAKE" GALLERY ---
        const group = new THREE.Group();
        scene.add(group);
        const textureLoader = new THREE.TextureLoader();
        const meshes = [];

        // Parameters for the curve
        const verticalSpacing = 4.0; // Distance between photos
        const curveRadius = 5.0; // How wide the curve swings

        imageFiles.forEach((fileName, i) => {
            // Encode URI to handle spaces safely
            const safeUrl = encodeURIComponent(fileName).replace(/%20/g, " ").replace(/\(/g, "%28").replace(/\)/g, "%29");

            textureLoader.load(safeUrl, (texture) => {
                // 1. Maintain Aspect Ratio
                const ratio = texture.image.width / texture.image.height;
                const h = 4.5; 
                const w = h * ratio;

                // 2. Material: BasicMaterial (Self-Illuminated) ensures visibility in dark scene
                const geometry = new THREE.PlaneGeometry(w, h);
                const material = new THREE.MeshBasicMaterial({ 
                    map: texture, 
                    side: THREE.DoubleSide 
                });

                // 3. Create Mesh
                const mesh = new THREE.Mesh(geometry, material);

                // 4. Position Logic (The Snake)
                // We stack them vertically (negative Y)
                const y = -i * verticalSpacing;
                
                // We oscillate Left/Right using Sine
                const x = Math.sin(i * 0.6) * curveRadius;
                
                // We oscillate Depth using Cosine
                const z = Math.cos(i * 0.4) * (curveRadius * 0.5) - 5;

                mesh.position.set(x, y, z);
                
                // 5. Orientation: Look at the center column
                mesh.lookAt(0, y, 0);
                
                // Add random tilt for organic feel
                mesh.rotation.z = (Math.random() - 0.5) * 0.2;

                // 6. Save data for animation
                mesh.userData = { 
                    originalY: y, 
                    originalX: x, 
                    offset: Math.random() * Math.PI 
                };

                group.add(mesh);
                meshes.push(mesh);
            });
        });

        // --- D. STARFIELD BACKGROUND ---
        const starGeo = new THREE.BufferGeometry();
        const starCount = 2000;
        const starPos = new Float32Array(starCount * 3);
        for(let i=0; i<starCount*3; i++) {
            starPos[i] = (Math.random() - 0.5) * 100;
        }
        starGeo.setAttribute('position', new THREE.BufferAttribute(starPos, 3));
        const starMat = new THREE.PointsMaterial({color: 0xffffff, size: 0.05, opacity: 0.8, transparent: true});
        const stars = new THREE.Points(starGeo, starMat);
        scene.add(stars);


        // --- E. SCROLL & INTERACTION SYSTEM ---
        let scrollY = 0;
        let targetScrollY = 0;
        
        // We want to scroll past all 28 images.
        // Total scrollable distance approx = Number of images
        const maxScroll = imageFiles.length + 5; 

        // Mouse Parallax Variables
        let mouseX = 0;
        let mouseY = 0;
        let targetMouseX = 0;
        let targetMouseY = 0;

        // Listeners
        window.addEventListener('wheel', (e) => {
            targetScrollY += e.deltaY * 0.003; // Scroll speed
            targetScrollY = Math.max(0, Math.min(targetScrollY, maxScroll));
        });

        window.addEventListener('mousemove', (e) => {
            // Normalize mouse position -1 to 1
            mouseX = (e.clientX / window.innerWidth) * 2 - 1;
            mouseY = (e.clientY / window.innerHeight) * 2 - 1;
        });

        // Touch support for mobile
        let touchStart = 0;
        window.addEventListener('touchstart', e => touchStart = e.touches[0].clientY);
        window.addEventListener('touchmove', e => {
            const delta = (touchStart - e.touches[0].clientY) * 0.005;
            targetScrollY += delta;
            targetScrollY = Math.max(0, Math.min(targetScrollY, maxScroll));
            touchStart = e.touches[0].clientY;
        });

        // --- F. MAIN ANIMATION LOOP ---
        const clock = new THREE.Clock();
        const sections = document.querySelectorAll('.story-section');
        const progressBar = document.getElementById('progress-line');

        function animate() {
            const time = clock.getElapsedTime();

            // 1. Smooth Scroll Damping
            scrollY += (targetScrollY - scrollY) * 0.05;

            // 2. Smooth Mouse Parallax Damping
            targetMouseX += (mouseX - targetMouseX) * 0.05;
            targetMouseY += (mouseY - targetMouseY) * 0.05;

            // 3. Move Camera
            // Move down the Y axis based on scroll
            camera.position.y = -scrollY * verticalSpacing;
            
            // Subtle camera tilt based on mouse
            camera.rotation.x = targetMouseY * 0.05;
            camera.rotation.y = targetMouseX * 0.05;
            camera.position.x = targetMouseX * 1; // Slight physical movement left/right

            // 4. Update Progress Bar
            const progress = scrollY / maxScroll;
            progressBar.style.width = `${Math.min(progress * 100, 100)}%`;

            // 5. Text Section Logic (The "Many Sections")
            // We map scroll percentage to section visibility
            sections.forEach(s => s.classList.remove('active'));

            if (progress < 0.10) {
                document.getElementById('sec-0').classList.add('active'); // Apology
            } else if (progress > 0.15 && progress < 0.25) {
                document.getElementById('sec-1').classList.add('active'); // Realization
            } else if (progress > 0.30 && progress < 0.45) {
                document.getElementById('sec-2').classList.add('active'); // Memories (The Long Scroll)
            } else if (progress > 0.55 && progress < 0.70) {
                document.getElementById('sec-3').classList.add('active'); // Anniversary
            } else if (progress > 0.75 && progress < 0.85) {
                document.getElementById('sec-4').classList.add('active'); // Promise
            } else if (progress > 0.90) {
                document.getElementById('sec-5').classList.add('active'); // Finale
            }

            // 6. Animate Objects
            meshes.forEach(m => {
                // Bobbing motion
                m.position.y = m.userData.originalY + Math.sin(time + m.userData.offset) * 0.15;
                // Slight rotation
                m.rotation.z += 0.0005;
            });
            stars.rotation.y = time * 0.02;

            renderer.render(scene, camera);
            requestAnimationFrame(animate);
        }
        animate();

        // --- G. HEART ZOOM INTRO (The "Great" one) ---
        const intro = document.getElementById('intro-layer');
        const heartWrapper = document.querySelector('.heart-wrapper');
        const music = document.getElementById('bg-music');

        intro.addEventListener('click', () => {
            // Play Audio
            music.volume = 0.5;
            music.play().catch(e => console.log("Audio prevented"));

            // GSAP Animation: Scale Heart to 50x (Covers screen with red)
            gsap.to(heartWrapper, {
                scale: 50,
                duration: 1.5,
                ease: "power2.inOut",
                onComplete: () => {
                    // Fade out the overlay to reveal the black 3D world
                    gsap.to(intro, {
                        opacity: 0,
                        duration: 1,
                        onComplete: () => {
                            intro.style.display = 'none';
                        }
                    });

                    // Reveal Canvas
                    document.getElementById('canvas-container').style.opacity = 1;
                    
                    // Initial Camera Fly-in
                    gsap.from(camera.position, {
                        y: 10,
                        duration: 2.5,
                        ease: "power3.out"
                    });
                }
            });
        });

        // Resize Handler
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });
    </script>
</body>
</html>
