<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>For You | Jan 12th</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,600;1,400&family=Montserrat:wght@300;400;500&display=swap" rel="stylesheet">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>

    <style>
        body { margin: 0; overflow: hidden; background-color: #000; color: white; font-family: 'Montserrat', sans-serif; }
        .serif { font-family: 'Playfair Display', serif; }

        /* --- HEART OPENER (The "Great" Animation) --- */
        #intro-layer {
            position: fixed; top: 0; left: 0; width: 100%; height: 100vh;
            background: #000; z-index: 100;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            cursor: pointer;
        }

        .heart-wrapper {
            position: relative; width: 100px; height: 100px;
            animation: pulse 1.5s infinite ease-in-out;
            transform-origin: center center;
        }

        .heart {
            width: 100px; height: 100px; background-color: #ff3860;
            transform: rotate(-45deg); position: absolute;
        }
        .heart::before, .heart::after {
            content: ""; width: 100px; height: 100px; background-color: #ff3860;
            border-radius: 50%; position: absolute;
        }
        .heart::before { top: -50px; left: 0; }
        .heart::after { top: 0; left: 50px; }

        .click-text {
            margin-top: 80px; text-transform: uppercase; letter-spacing: 0.3em; 
            font-size: 0.8rem; color: #ff3860; opacity: 0.8;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        /* --- UI LAYERS --- */
        #canvas-container { position: fixed; top: 0; left: 0; width: 100%; height: 100vh; z-index: 1; opacity: 0; }
        
        #ui-layer {
            position: fixed; top: 0; left: 0; width: 100%; height: 100vh;
            z-index: 10; pointer-events: none;
        }

        /* --- GLASS SECTIONS --- */
        .slide {
            position: absolute; width: 100%; height: 100%;
            display: flex; justify-content: center; align-items: center;
            opacity: 0; transform: translateY(50px) scale(0.95);
            transition: all 1.2s cubic-bezier(0.16, 1, 0.3, 1);
        }
        .slide.active { opacity: 1; transform: translateY(0) scale(1); }

        .glass-box {
            background: rgba(15, 15, 20, 0.65);
            backdrop-filter: blur(16px); -webkit-backdrop-filter: blur(16px);
            border: 1px solid rgba(255, 255, 255, 0.15);
            padding: 4rem; max-width: 600px; text-align: center;
            border-radius: 2px;
            box-shadow: 0 20px 50px rgba(0,0,0,0.8);
        }

        /* Error Log for Debugging */
        #error-log {
            position: fixed; top: 10px; left: 10px; z-index: 200;
            background: rgba(255, 0, 0, 0.8); padding: 10px; color: white;
            font-size: 12px; display: none; max-width: 300px;
        }
    </style>
</head>
<body>

    <audio id="bg-music" loop><source src="song.mp3" type="audio/mpeg"></audio>

    <div id="error-log"></div>

    <div id="intro-layer">
        <div class="heart-wrapper">
            <div class="heart"></div>
        </div>
        <div class="click-text">Click to Open My Heart</div>
    </div>

    <div id="canvas-container"></div>

    <div id="ui-layer">
        
        <div class="slide active" id="s0">
            <div class="glass-box">
                <h1 class="serif text-5xl mb-4 text-white">I'm Sorry</h1>
                <div class="h-0.5 w-16 bg-pink-500 mx-auto mb-6"></div>
                <p class="text-gray-300 text-lg leading-relaxed">
                    I messed up. I know I did. Seeing you hurt is the last thing I ever want.
                    <br><br>
                    <span class="text-xs uppercase tracking-widest text-gray-500">Scroll Down Slowly</span>
                </p>
            </div>
        </div>

        <div class="slide" id="s1" style="align-items: flex-end; padding-bottom: 10%;">
            <div class="glass-box" style="margin-left: 5%;">
                <h1 class="serif text-4xl mb-2">Our Memories</h1>
                <p class="text-gray-300">
                    Look at us. Look at how happy we are. 
                    I don't want to lose this sparkle over a moment of anger.
                </p>
            </div>
        </div>

        <div class="slide" id="s2">
            <div class="glass-box">
                <p class="text-pink-400 uppercase tracking-widest text-sm mb-2">Coming Soon</p>
                <h1 class="serif text-6xl text-white mb-2">Jan 12th</h1>
                <p class="text-2xl serif italic text-gray-200">Our Anniversary</p>
                <br>
                <p class="text-gray-400">Let's make this day beautiful.</p>
            </div>
        </div>

        <div class="slide" id="s3">
            <div class="glass-box">
                <h1 class="serif text-5xl mb-4">I Love You</h1>
                <p class="text-xl text-pink-300 italic">Please forgive me?</p>
            </div>
        </div>

    </div>

    <script>
        // --- 1. THE EXACT FILENAMES ---
        const imageFiles = [
            "WhatsApp Image 2025-12-27 at 3.28.59 PM.jpeg",
            "WhatsApp Image 2025-12-27 at 3.29.13 PM.jpeg",
            "WhatsApp Image 2025-12-27 at 3.29.14 PM.jpeg",
            "WhatsApp Image 2025-12-27 at 3.29.15 PM (1).jpeg",
            "WhatsApp Image 2025-12-27 at 3.29.15 PM (2).jpeg",
            "WhatsApp Image 2025-12-27 at 3.29.15 PM.jpeg",
            "WhatsApp Image 2025-12-27 at 3.29.16 PM (1).jpeg",
            "WhatsApp Image 2025-12-27 at 3.29.16 PM.jpeg",
            "WhatsApp Image 2025-12-27 at 3.29.17 PM (1).jpeg",
            "WhatsApp Image 2025-12-27 at 3.29.17 PM (2).jpeg",
            "WhatsApp Image 2025-12-27 at 3.29.17 PM.jpeg",
            "WhatsApp Image 2025-12-27 at 3.29.18 PM (1).jpeg",
            "WhatsApp Image 2025-12-27 at 3.29.18 PM.jpeg",
            "WhatsApp Image 2025-12-27 at 3.29.19 PM (1).jpeg",
            "WhatsApp Image 2025-12-27 at 3.29.19 PM (2).jpeg",
            "WhatsApp Image 2025-12-27 at 3.29.19 PM.jpeg",
            "WhatsApp Image 2025-12-27 at 3.29.20 PM (1).jpeg",
            "WhatsApp Image 2025-12-27 at 3.29.20 PM.jpeg",
            "WhatsApp Image 2025-12-27 at 3.29.21 PM (1).jpeg",
            "WhatsApp Image 2025-12-27 at 3.29.21 PM (2).jpeg",
            "WhatsApp Image 2025-12-27 at 3.29.21 PM.jpeg",
            "WhatsApp Image 2025-12-27 at 3.29.22 PM (1).jpeg",
            "WhatsApp Image 2025-12-27 at 3.29.22 PM.jpeg",
            "WhatsApp Image 2025-12-27 at 3.29.23 PM (1).jpeg",
            "WhatsApp Image 2025-12-27 at 3.29.23 PM.jpeg",
            "WhatsApp Image 2025-12-27 at 3.29.24 PM.jpeg",
            "WhatsApp Image 2025-12-31 at 2.29.37 PM.jpeg",
            "WhatsApp Image 2026-01-02 at 12.26.15 AM.jpeg"
        ];

        // --- 2. THREE.JS SETUP ---
        const container = document.getElementById('canvas-container');
        const scene = new THREE.Scene();
        // Dark fog for the void effect
        scene.fog = new THREE.FogExp2(0x000000, 0.035);

        const camera = new THREE.PerspectiveCamera(70, window.innerWidth / window.innerHeight, 0.1, 1000);
        camera.position.z = 0;
        camera.position.y = 0;

        const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
        // Use sRGB encoding for better color on textures
        renderer.outputEncoding = THREE.sRGBEncoding;
        container.appendChild(renderer.domElement);

        // --- 3. LIGHTING (CRITICAL FOR VISIBILITY) ---
        // Bright ambient light ensures photos are never black
        const ambientLight = new THREE.AmbientLight(0xffffff, 0.8);
        scene.add(ambientLight);

        // Spotlights for drama
        const spot1 = new THREE.SpotLight(0xff6b9d, 1.5);
        spot1.position.set(10, 20, 10);
        scene.add(spot1);
        
        const spot2 = new THREE.SpotLight(0x4cc9f0, 1.5);
        spot2.position.set(-10, -20, 10);
        scene.add(spot2);

        // --- 4. GALLERY GENERATION ---
        const group = new THREE.Group();
        scene.add(group);
        const textureLoader = new THREE.TextureLoader();
        const meshes = [];

        // Error Handler
        const logError = (msg) => {
            const el = document.getElementById('error-log');
            el.style.display = 'block';
            el.innerHTML += msg + "<br>";
        };

        // Create the Spiral
        const radius = 6; 
        const ySpacing = 3; 

        imageFiles.forEach((fileName, i) => {
            // Encode the filename to handle spaces/parentheses safely
            const safeUrl = encodeURIComponent(fileName)
                                .replace(/%20/g, " ") // Sometimes browsers prefer literal spaces in local files
                                .replace(/\(/g, "%28")
                                .replace(/\)/g, "%29");

            textureLoader.load(
                fileName, // Try loading direct name first
                (texture) => {
                    // Success!
                    const ratio = texture.image.width / texture.image.height;
                    const h = 4;
                    const w = h * ratio; // Maintain aspect ratio
                    
                    const geom = new THREE.PlaneGeometry(w, h);
                    const mat = new THREE.MeshBasicMaterial({ // MeshBasicMaterial doesn't need light, so it's ALWAYS visible
                        map: texture,
                        side: THREE.DoubleSide
                    });
                    
                    // Glass Overlay for reflection (Optional polish)
                    const glassGeo = new THREE.PlaneGeometry(w, h);
                    const glassMat = new THREE.MeshPhysicalMaterial({
                        color: 0xffffff, transmission: 0.1, roughness: 0.1, 
                        metalness: 0.1, transparent: true, opacity: 0.3
                    });
                    const glassMesh = new THREE.Mesh(glassGeo, glassMat);
                    glassMesh.position.z = 0.05; // Slightly in front

                    const mesh = new THREE.Group();
                    mesh.add(new THREE.Mesh(geom, mat)); // The Photo
                    mesh.add(glassMesh); // The Shine

                    // Position
                    const angle = i * 0.7;
                    const y = -i * ySpacing;
                    
                    mesh.position.set(
                        Math.cos(angle) * radius,
                        y,
                        Math.sin(angle) * radius
                    );
                    
                    mesh.lookAt(0, y, 0); // Face center
                    mesh.rotation.y += Math.PI; // Correct direction

                    // Floating Logic
                    mesh.userData = { originalY: y, phase: Math.random() * Math.PI };
                    
                    group.add(mesh);
                    meshes.push(mesh);
                },
                undefined,
                (err) => {
                    console.error("Error loading image:", fileName, err);
                    logError(`Failed to load: ${fileName}. Check file exists? Security block?`);
                }
            );
        });

        // Dust/Stars
        const starsGeo = new THREE.BufferGeometry();
        const starCount = 1000;
        const starPos = new Float32Array(starCount * 3);
        for(let i=0; i<starCount*3; i++) starPos[i] = (Math.random()-0.5)*50;
        starsGeo.setAttribute('position', new THREE.BufferAttribute(starPos,3));
        const starsMat = new THREE.PointsMaterial({color:0xffffff, size:0.05, opacity:0.6, transparent:true});
        const starSystem = new THREE.Points(starsGeo, starsMat);
        scene.add(starSystem);


        // --- 5. ANIMATION LOOP ---
        let scrollY = 0;
        let targetScrollY = 0;
        const slides = document.querySelectorAll('.slide');
        
        window.addEventListener('wheel', (e) => {
            targetScrollY += e.deltaY * 0.002;
            targetScrollY = Math.max(0, Math.min(targetScrollY, slides.length - 0.5));
        });

        const clock = new THREE.Clock();

        function animate() {
            const time = clock.getElapsedTime();

            // Smooth Scroll
            scrollY += (targetScrollY - scrollY) * 0.08;

            // Camera moves down the spiral
            camera.position.y = -scrollY * 12;
            camera.rotation.y = scrollY * 0.3;

            // Slides fade in/out
            slides.forEach((slide, i) => {
                const dist = Math.abs(scrollY - i);
                if(dist < 0.6) slide.classList.add('active');
                else slide.classList.remove('active');
            });

            // Float images
            meshes.forEach(m => {
                m.position.y = m.userData.originalY + Math.sin(time + m.userData.phase) * 0.2;
            });
            starSystem.rotation.y = time * 0.05;

            renderer.render(scene, camera);
            requestAnimationFrame(animate);
        }
        animate();


        // --- 6. THE HEART ZOOM ANIMATION (Restored) ---
        const intro = document.getElementById('intro-layer');
        const heartWrapper = document.querySelector('.heart-wrapper');
        const music = document.getElementById('bg-music');

        intro.addEventListener('click', () => {
            // 1. Play Music
            music.volume = 0.5;
            music.play().catch(e => console.log("Music prevented by browser"));

            // 2. The Great Zoom Effect
            // We scale the heart wrapper HUGE so the red "heart" fills the screen
            gsap.to(heartWrapper, {
                scale: 60, 
                duration: 1.5, 
                ease: "power2.inOut",
                onComplete: () => {
                    // 3. Fade out the whole black overlay to reveal 3D
                    gsap.to(intro, {
                        opacity: 0,
                        duration: 1,
                        onComplete: () => {
                            intro.style.display = 'none';
                        }
                    });
                    
                    // 4. Reveal Canvas
                    document.getElementById('canvas-container').style.opacity = 1;
                    
                    // 5. Initial Camera Fly-In
                    gsap.from(camera.position, {
                        y: 10,
                        duration: 2,
                        ease: "power3.out"
                    });
                }
            });
        });

        // Resize
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth/window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });
    </script>
</body>
</html>